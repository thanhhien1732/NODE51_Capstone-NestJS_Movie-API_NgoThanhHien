generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Banners {
  bannerId Int     @id @default(autoincrement())
  movieId  Int?
  image    String? @db.VarChar(255)
  Movies   Movies? @relation(fields: [movieId], references: [movieId], onDelete: Cascade, map: "Banners_ibfk_1")

  @@index([movieId], map: "movieId")
}

model CinemaClusters {
  clusterId     Int            @id @default(autoincrement())
  clusterName   String         @db.VarChar(100)
  address       String?        @db.VarChar(255)
  systemId      Int?
  CinemaSystems CinemaSystems? @relation(fields: [systemId], references: [systemId], onDelete: Cascade, map: "CinemaClusters_ibfk_1")
  Cinemas       Cinemas[]

  @@index([clusterName], map: "idxClusterName")
  @@index([systemId], map: "systemId")
}

model CinemaSystems {
  systemId       Int              @id @default(autoincrement())
  systemName     String           @db.VarChar(100)
  logo           String?          @db.VarChar(255)
  CinemaClusters CinemaClusters[]
}

model Cinemas {
  cinemaId       Int              @id @default(autoincrement())
  cinemaName     String           @db.VarChar(100)
  roomCount      Int?             @default(5)
  clusterId      Int?
  CinemaClusters CinemaClusters?  @relation(fields: [clusterId], references: [clusterId], onDelete: Cascade, map: "Cinemas_ibfk_1")
  ScreeningRooms ScreeningRooms[]

  @@index([clusterId], map: "clusterId")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model Movies {
  movieId     Int         @id @default(autoincrement())
  title       String      @db.VarChar(255)
  trailer     String?     @db.VarChar(255)
  poster      String?     @db.VarChar(255)
  description String?     @db.Text
  releaseDate DateTime?   @db.Date
  endDate     DateTime?   @db.Date
  rating      Int?
  isHot       Boolean?    @default(false)
  isShowing   Boolean?    @default(false)
  isComing    Boolean?    @default(false)
  Banners     Banners[]
  Showtimes   Showtimes[]

  @@index([title], map: "idxMovieTitle")
}

model ScreeningRooms {
  roomId    Int         @id @default(autoincrement())
  roomName  String      @db.VarChar(100)
  roomType  String?     @default("2D") @db.VarChar(50)
  capacity  Int?        @default(100)
  cinemaId  Int?
  Cinemas   Cinemas?    @relation(fields: [cinemaId], references: [cinemaId], onDelete: Cascade, map: "ScreeningRooms_ibfk_1")
  Seats     Seats[]
  Showtimes Showtimes[]

  @@index([cinemaId], map: "cinemaId")
}

model Seats {
  seatId         Int             @id @default(autoincrement())
  seatName       String?         @db.VarChar(50)
  seatType       String?         @default("Standard") @db.VarChar(50)
  rowLabel       String?         @db.VarChar(5)
  columnIndex    Int?
  roomId         Int?
  ScreeningRooms ScreeningRooms? @relation(fields: [roomId], references: [roomId], onDelete: Cascade, map: "Seats_ibfk_1")
  Tickets        Tickets[]

  @@index([roomId], map: "roomId")
}

model Showtimes {
  showtimeId      Int             @id @default(autoincrement())
  movieId         Int?
  roomId          Int?
  showDatetime    DateTime        @db.DateTime(0)
  ticketPrice     Int
  durationMinutes Int?            @default(120)
  Movies          Movies?         @relation(fields: [movieId], references: [movieId], onDelete: Cascade, map: "Showtimes_ibfk_1")
  ScreeningRooms  ScreeningRooms? @relation(fields: [roomId], references: [roomId], onDelete: Cascade, map: "Showtimes_ibfk_2")
  Tickets         Tickets[]

  @@index([movieId], map: "movieId")
  @@index([roomId], map: "roomId")
}

model Tickets {
  userId      Int
  showtimeId  Int
  seatId      Int
  bookingDate DateTime? @default(now()) @db.DateTime(0)
  totalPrice  Int?      @default(0)
  Users       Users     @relation(fields: [userId], references: [userId], onDelete: Cascade, map: "Tickets_ibfk_1")
  Showtimes   Showtimes @relation(fields: [showtimeId], references: [showtimeId], onDelete: Cascade, map: "Tickets_ibfk_2")
  Seats       Seats     @relation(fields: [seatId], references: [seatId], onDelete: Cascade, map: "Tickets_ibfk_3")

  @@id([userId, showtimeId, seatId])
  @@index([seatId], map: "seatId")
  @@index([showtimeId], map: "showtimeId")
}

model Users {
  userId      Int       @id @default(autoincrement())
  fullName    String    @db.VarChar(100)
  email       String    @unique(map: "email") @db.VarChar(100)
  phoneNumber String?   @db.VarChar(20)
  avatar      String?   @db.VarChar(255)
  facebookId  String?   @unique(map: "facebookId") @db.VarChar(255)
  googleId    String?   @unique(map: "googleId") @db.VarChar(255)
  password    String    @db.VarChar(255)
  roleId      Int?      @default(2)
  createdAt   DateTime? @default(now()) @db.DateTime(0)
  updatedAt   DateTime? @default(now()) @db.DateTime(0)
  deletedBy   String?   @db.VarChar(100)
  isDeleted   Boolean?  @default(false)
  deletedAt   DateTime? @db.DateTime(0)
  Tickets     Tickets[]
  Roles       Roles?    @relation(fields: [roleId], references: [roleId], map: "Users_ibfk_1")

  @@index([email], map: "idxUserEmail")
  @@index([roleId], map: "roleId")
}

model Analytics {
  analyticsId Int       @id @default(autoincrement())
  metricName  String    @db.VarChar(255)
  metricValue Decimal?  @default(0.00) @db.Decimal(18, 2)
  module      String?   @db.VarChar(100)
  recordedAt  DateTime? @default(now()) @db.DateTime(0)
  description String?   @db.Text
  createdAt   DateTime? @default(now()) @db.DateTime(0)
  updatedAt   DateTime? @default(now()) @db.DateTime(0)
}

model Permissions {
  permissionId   Int              @id @default(autoincrement())
  name           String           @db.VarChar(255)
  endpoint       String           @db.VarChar(255)
  method         String           @db.VarChar(100)
  module         String           @db.VarChar(100)
  deletedBy      String?          @db.VarChar(100)
  isDeleted      Boolean?         @default(false)
  deletedAt      DateTime?        @db.DateTime(0)
  createdAt      DateTime?        @default(now()) @db.DateTime(0)
  updatedAt      DateTime?        @default(now()) @db.DateTime(0)
  RolePermission RolePermission[]
}

model RolePermission {
  id           Int         @id @default(autoincrement())
  roleId       Int
  permissionId Int
  isActive     Boolean?    @default(true)
  deletedBy    String?     @db.VarChar(100)
  isDeleted    Boolean?    @default(false)
  deletedAt    DateTime?   @db.DateTime(0)
  createdAt    DateTime?   @default(now()) @db.DateTime(0)
  updatedAt    DateTime?   @default(now()) @db.DateTime(0)
  Roles        Roles       @relation(fields: [roleId], references: [roleId], onDelete: Cascade, map: "RolePermission_ibfk_1")
  Permissions  Permissions @relation(fields: [permissionId], references: [permissionId], onDelete: Cascade, map: "RolePermission_ibfk_2")

  @@index([permissionId], map: "permissionId")
  @@index([roleId], map: "roleId")
}

model Roles {
  roleId         Int              @id @default(autoincrement())
  name           String           @db.VarChar(255)
  description    String?          @db.VarChar(255)
  isActive       Boolean?         @default(true)
  deletedBy      String?          @db.VarChar(100)
  isDeleted      Boolean?         @default(false)
  deletedAt      DateTime?        @db.DateTime(0)
  createdAt      DateTime?        @default(now()) @db.DateTime(0)
  updatedAt      DateTime?        @default(now()) @db.DateTime(0)
  RolePermission RolePermission[]
  Users          Users[]
}
